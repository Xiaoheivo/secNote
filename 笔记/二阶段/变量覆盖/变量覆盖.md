## 变量覆盖

### 变量覆盖的原理是什么？

攻击者提供的包含变量参数对的内容被一些敏感函数处理后，生成的变量覆盖了原有变量，造成依赖原变量的逻辑发生改变。

### PHP中变量覆盖涉及哪些字符和函数？

```php
$$
extract()
parse_str()
mb_parse_str()
import_request_variables()//全局变量注册
```

### 课堂练习：获得flag

素材——flag.php

```php
<?php
$flag = "flag{UWIN-2022-1014}";
?>
```

素材——.htaccess

```php
<FilesMatch "flag.php">
Order Allow,Deny
Deny from all
</FilesMatch>
```

第一题doubleDollar.php

```php
<?php
include "flag.php";
$_403 = "Access Denied";
$_200 = "Welcome Admin";
if ($_SERVER["REQUEST_METHOD"] != "POST")
{
die("BugsBunnyCTF is here :p…");
}
if ( !isset($_POST["flag"]) )
{
die($_403);
}
foreach ($_GET as $key => $value)
{
$$key = $$value;
}
foreach ($_POST as $key => $value)
    {
$$key = $value;
}
if ( $_POST["flag"] !== $flag )
{
die($_403);
}
echo "This is your flag : ". $flag . "\n";
die($_200);
?>
```

payload

```

```





第二题extract.php

```php
<?php
include("flag.php");
$a = "0";
extract($_GET);
// ?a=1&b=2;
//$a = 1;
//$b = 2;
if( $a == 1 ){
echo $flag;
}else{
echo "no way!";
}
?>
```

第三题parse_str.php

```php
<?php
error_reporting(0);
if (empty($_GET["id"]))
{
show_source(__FILE__);
die();
}
else
{
include ("flag.php");
$a = "www.OPENCTF.com";
$id = $_GET["id"];
@parse_str($id);
if ($a[0] != "QNKCDZO" && md5($a[0]) == md5("QNKCDZO"))
{
echo $flag;
}
else
{
exit("其实很简单其实并不难！");
}
}
?>
```

第四题 import_request_variables.php

支持版本 php4>=4.0.1 php5<5.4.0

 import_request_variables()函数将GET、POST、Cookies中的变量导入全局 `bool import_request_variables(string $types[,string $prefix])`

```php
<?php
include('flag.php');
$a = "0";
//将a变量作为get型全局变量注册，G为GET，P代表POST，C代表COOKI
import_request_variables("G");
if ($a == 1) {
echo $flag;
} else {
echo "no way!";
}
?>
```

### 参考

md5运算后是0e开头的原文字符串(可以添加进密码字段爆破的时候用)

> QNKCDZO
>  0e830400451993494058024219903391
>
> 240610708
>  0e462097431906509019562988736854
>
> s878926199a
>  0e545993274517709034328855841020
>
> s155964671a
>  0e342768416822451524974117254469
>
> s214587387a
>  0e848240448830537924465865611904
>
> s214587387a
>  0e848240448830537924465865611904
>
> s878926199a
>  0e545993274517709034328855841020
>
> s1091221200a
>  0e940624217856561557816327384675
>
> s1885207154a
>  0e509367213418206700842008763514
>
> s1502113478a
>  0e861580163291561247404381396064
>
> s1885207154a
>  0e509367213418206700842008763514
>
> s1836677006a
>  0e481036490867661113260034900752
>
> s155964671a
>  0e342768416822451524974117254469
>
> s1184209335a
>  0e072485820392773389523109082030
>
> s1665632922a
>  0e731198061491163073197128363787
>
> s1502113478a
>  0e861580163291561247404381396064
>
> s1836677006a
>  0e481036490867661113260034900752
>
> s1091221200a
>  0e940624217856561557816327384675
>
> s155964671a
>  0e342768416822451524974117254469
>
> s1502113478a
>  0e861580163291561247404381396064
>
> s155964671a
>  0e342768416822451524974117254469
>
> s1665632922a
>  0e731198061491163073197128363787
>
> s155964671a
>  0e342768416822451524974117254469
>
> s1091221200a
>  0e940624217856561557816327384675
>
> s1836677006a
>  0e481036490867661113260034900752
>
> s1885207154a
>  0e509367213418206700842008763514
>
> s532378020a
>  0e220463095855511507588041205815
>
> s878926199a
>  0e545993274517709034328855841020
>
> s1091221200a
>  0e940624217856561557816327384675
>
> s214587387a
>  0e848240448830537924465865611904
>
> s1502113478a
>  0e861580163291561247404381396064
>
> s1091221200a
>  0e940624217856561557816327384675
>
> s1665632922a
>  0e731198061491163073197128363787
>
> s1885207154a
>  0e509367213418206700842008763514
>
> s1836677006a
>  0e481036490867661113260034900752
>
> s1665632922a
>  0e731198061491163073197128363787
>
> s878926199a
>  0e545993274517709034328855841020
>
> 
>
> 作者：yueyejian
> 链接：https://www.jianshu.com/p/d3a9e7de0b12
> 来源：简书
> 著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。