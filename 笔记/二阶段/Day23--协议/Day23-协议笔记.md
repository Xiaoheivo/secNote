[toc]

## 二阶段内容介绍:

- 协议
- 操作系统
- 网站漏洞攻击与防护
- 其他漏洞攻击和防护

## 今日目标:

- 了解TCP/IP协议
- 理解,掌握HTTP协议的标准细节

## 学习内容:

协议:网络协议的简称,网络协议是通信计算机双方必须共同遵从的一组约定。如怎么样建立连接,怎么样相互识别等,只有双方都遵守这个约定,计算机之间才能相互通信交流。

### 什么是协议？

​	通信双方约定的对于变化信息的理解规则

### HTTP协议

##### 什么是HTTP协议?

Hyper-Text Transfer Protocol

传输网页相关信息的协议

##### HTTP协议最新版本?

​	==3(HTTP3 也叫做QUIC协议)==

##### QUIC协议由传输层哪个协议支撑?

​	http1.1以及之前的版本的http协议是由TCP支撑的,但是HTTP3是由UDP支撑的。

​	==UDP==

##### 谁构造并发起了HTTP请求?

 http客户端,比如浏览器等,也可以自己通过编程编写http客户端任意构造http请求。

##### HTTP协议的请求/响应包含哪些部分？(HTTP协议报文长什么样子?)

- 请求包:

  ![image-20220825093827444](Day23-协议笔记.assets/image-20220825093827444.png)

  

- 响应包:

  ![image-20220825093835007](Day23-协议笔记.assets/image-20220825093835007.png)

  

##### HTTP协议的请求/响应头各自的含义是什么?

1. HTTP请求的关键字段及含义

   1. 包含了哪些部分?

      请求头和请求体

      请求体中包含了请求行和其他部分

   2. 请求行中有哪些内容?

      1. 请求方法,资源路径(GET方法中还包含了变量和参数的键值对),HTTP协议的版本

         ![image-20220825155405449](Day23-协议笔记.assets/image-20220825155405449.png)

   3. 请求头中的其他部分字段:

      1. HOST:当一台服务器上面建立多个网站的时候,需要客户端在HOST的值中告诉服务器要访问哪个网站

         **相关知识:可用于host碰撞,通过尝试不同域名放入HOST字段中从而找出服务器上的多个网站**

      2. User_Agent字段:客服端向服务器表明自己的身份

      3. referer:告诉服务器是从哪个页面跳转过来访问当前资源的

      4. Connection:告诉服务器完成当前请求后是否关闭连接(通道),可取值:close/keep-alive。（keep-alive一般有时长限制，不会一直保持连接）

      5. Content-Type：告诉服务器当前发送的内容的类型

      6. Content-Length：告诉服务器发送内容的长度（请求体的长度）

      7. cookie:告诉服务器自己的cookie(cookie是服务器下发给客户端的标记)

2. HTTP响应中的关键字段及含义

   1. 响应包包含什么?响应头和响应体

   2. 响应头包含什么？响应行和其他字段

   3. 响应行包含 什么？HTTP版本、响应状态码、状态信息

      ![image-20220825155049843](Day23-协议笔记.assets/image-20220825155049843.png)

   4. 响应头的其他字段:
      1. Server：告诉客户端服务器中间件的相关信息
      2. X-Powered-By:告诉客户端动态脚本解析器的信息
      3. Content-Length:告诉客户端响应体的长度
      4. Content-Type:告诉客户端响应体内容的类型
      5. set-cookie:服务器为客户端下发并设置cookie
      6. Location:告诉客户端跳转到哪个URL地址

      ==响应头可以自定义字段!==

      eg.

      ```php
      <php
      header("字段名:字段值");
      ?>
      ```

##### URL有哪些组成部分?各自含义是什么?

例子:

1. http://www.xxx.com,协议 主机地址
2. http://www.xxx.com:8081 端口号
3. ftp://www.xxx.com:8081端口号
4. http://www.xxx.com:8081/logic/test.php?
5. http://www.xxx.com:8081/logic/test.php?q=666
6. http://www.xxx.com:8081/logic/test.php?q=666&c=888
7. http://admin:qweASD@www.xxx.com:8081/logic/php/info.php?host=adong&guest=browser#version

格式:

> 协议://用户名:密码@子域名.域名.顶级域名:端口号/目录/文件名.文件后缀?变量=参数#标志

##### HTTP状态码有哪些？各自含义是什么？

| 分类 | 描述                                                         |
| ---- | ------------------------------------------------------------ |
| 1**  | 信息,服务器收到请求,需要请求者继续执行操作                   |
| 2**  | 成功,操作被成功接收并处理                                    |
| 3**  | 跳转                                                         |
| 4**  | 资源错误                                                     |
| 5**  | 服务端错误,服务器在处理请求的过程中发生了错误<br />Dos 攻击造成 |

常见的HTTP状态码:

- 200-请求成功
- 301-资源(网页等)被永久转移到其他URL
- 404-请求的资源不存在
- 500-内部服务器错误



##### HTTP请求方式有哪些？有何作用？

| 序号  | 请求方式    | 功能                                        | 常见应用场景                  |
| ----- | ----------- | ------------------------------------------- | ----------------------------- |
| **1** | **GET**     | **主要用于请求指定的资源**                  | **点击链接部分表单提交**      |
| **2** | **POST**    | **向指定资源提交数据以便进行处理**          | **大多数表单提交,文件上传等** |
| **3** | **HEAD**    | **类似于GET,不过只返回响应头,不返回响应体** | **探测资源是否存在**          |
| **4** | **PUT**     | **直接上传文件等内容给服务器的某个文件**    | **直接上传文件给服务器**      |
| **5** | **DELETE**  | **让服务器删除指定资源**                    | **直接删除服务器上的文件**    |
| 6     | CONNECT     | 把http协议作为其他协议的管道                |                               |
| **7** | **OPTIONS** | **探测服务器支持的请求方法**                |                               |
| 8     | TRACE       | 回显服务器收到的请求,用于测试或者诊断       |                               |
| 9     | PATCH       | 是对PUT的补充,用来对已知资源进行局部更新    |                               |




### TCP/IP协议簇

##### TCP/IP包含了有哪些协议？有多少种？

​	包含了很多层的协议,不仅仅是TCP和IP两种协议

​	数量很多,无法数出来

##### OSI模型,TCP/IP模型中网络协议分为多少层?

​	OSI模型把计算机网络分为7层,如图

![image-20220825160516771](Day23-协议笔记.assets/image-20220825160516771.png)

​	TCP/IP分4层,之所以见到很多分5层的,是为了方便理解,如图:

![image-20220825160550946](Day23-协议笔记.assets/image-20220825160550946.png)



##### TCP/IP各层协议有何作用?各层网络协议需要解决什么问题?

1. 网络接口层:通过MAC地址通信,大规模终端进行网络通信会造成网络风暴,所以需要划分网络进行通信,于是出现了网络层来解决需求
2. 网络层:采取IP协议,通过网络地址(IP地址)跨网络通信,不相关网络不会接收到目标地址非本网络的网络包,减少了网络风暴 。但是无法直接收发数据,无法做到:1.区分对方发来的数据应该交给哪个程序处理;2.难以解决网络不稳定等情况造成的丢包问题。对于1,需要通过端口来区分,包含端口相关规范的UDP协议诞生了;对于2,需要设计新的传输质量控制协议,于是传输层中的TCP协议诞生了。
3. 传输层:包括TCP/UDP协议。通过端口,把接收到的数据包交给目标计算机(服务器也是计算机的一种)上不同的网络服务(程序)处理。通过TCP协议,可以保证传输质量
4. 应用层:在各类数据通信需求中,为服务端程序和客户端程序通信确定标准。通过链路层、网络层、传输层的协议建立的连接，计算机中不同程序已经能够进行通信了。但是，人们需要用到网络传输数据的场景越来越多，开发的网络程序也就越来越多。不同网络程序之间进行通信需要有一套程序的客户端和服务端通信的标准，于是应用层产生了。对应不同的典型的数据通信需求，诞生了不同的应用层协议。比如HTTP、FTP协议等等。

##### TCP协议建立连接为什么是3次握手？

​	A:第一次发起请求

​	B:第一次收到请求，证明A可以正常发送

​	A:第一次响应返回后A收到了，证明B可以正常收发，A能够正常接收

##### 如何确定远程计算机是否在线？

​	可以尝试ping+目标计算机的ip来判断齐是否在线,但是ping不是绝对可靠,ping不通并不能证明该计算机不在线。

​	通常通过多种方式进行判断，而且还需要目标 终端（比如服务器、个人计算机）的配置进行配合

##### IPV4地址的形式是什么？

​	IP地址的长度为32位（4字节）分为四部分，一字节为1部分，用点号（.）分隔。

​	一般使用点分十进制表示，如：192.168.1.1 每部分的最小值为0，最大值为255。

##### 子网掩码有何作用？

​	和IP地址连用，以确定设备的网络号、主机号，以此来划分子网

##### 在浏览器地址栏输入URL按下回车后发生了什么？

​	如果输入的是域名，则先进行域名解析：

> 浏览器向操作系统发起郁闷解析请求——》操作系统一次检索本地缓存、host文件、DNS服务器来找到对应的网站服务器IP，然后向目标服务器发起HTTP请求。
>
> 如果请求的是静态资源，则服务器中间件读取对应的静态资源直接返回给浏览器。
>
> 如果请求的是动态资源，则服务器上的中间件按照配置文件规定将该文件的解析请求转发给动态脚本解析器，由动态脚本解析器解析后把结果发回给中间件，再由中间件转发给浏览器。浏览器收到中间件的返回结果后进行渲染。

##### 典型网络协议及其应用：

1. DNS协议：将域名转换成IP地址
2. ARP协议：将IP地址转换成MAC地址
3. HTTP协议：传输网页相关内容
4. ICMP：ping命令用到的协议
5. HTTPS的协议：安全的传输网页内容

### HTTPS协议（理解就行）

##### 利用HTTP协议通信安全吗？

​	依据安全的CIA三要素：可用性、保密性、完整性来讲，明文的HTTP协议通信是不安全的。

##### HTTPS的必要性？

- 你如何知道访问的网站内容在传输过程中没有被第三方篡改过？
- 你如何知道返回的网页确实是目标组织的网页？
- 你如何保证敏感信息在传输过程不被他人看到？

##### 什么是HTTPS？

​	一种加密HTTP传输协议。协议又两部分构成：

​	HTTP协议+SSL协议

​	收发双方能够通过SSL协议把HTTP协议内容进行加密和签名后传输。

##### HTTPS协议默认端口号是多少？

HTTPS服务监听的默认端口是443号端口

##### HTTPS使用的是对称加密还是非对称加密算法？

HTTPS通信过程中使用混合加密（同时包含了对称加密和非对称加密）

##### HTTPS通信过程？

- 客户端向服务器发起HTTPS请求

- 服务器返回公钥证书给客户端

- 客户端校验证书有效后，生成一个随机数作为对称密钥，将该对称密钥用服务器的公钥加密后传输给服务器

  基本前提/常识:非对称加密算法中,使用加密通信的双方有两把秘钥,即公钥和私钥。在传输数据保密的场景下：公钥用于加密，私钥用于解密。公钥可以发给公众，私钥为服务器私有。在身份验证场景下：私钥用于加密，公钥用于解密。

- 服务器用自己私钥解开得到的随机数，后续双方使用该随机数进行对称加密通信。

##### HTTPS如何防止公钥被篡改？

将公钥放在证书中，如果证书受到信任，能表明组织身份，则证书中的公钥就受到信任。

##### 服务端生成的证书有什么内容？

HTTPS证书由服务器生产，大致包含两部分：

- 明文身份信息字符串。包含了发送方的名称、代表的域名......等等
- hash加密字符串。对上述信息进行hash运算，得到一个hash值（与明文的身份信息几乎一一对应），然后对该hash值用私钥进行签名（加密），生成另一个字符串。

##### HTTPS验证证书的流程

客户端利用公钥将hash加密字符串进行解密，得到一个hash，将该hash与明文身份信息字符串运算后的hash进行比对，如果比对一致，则说明该证书确实是目标组织签发。

基础常识：

1. 客户端能之间从证书中看见明文身份信息，但还需要证明这些身份信息确实是目标服务器所属组织；
2. 在身份认证场景下：只有目标组织的公钥才能验证（解密）目标组织私钥签名（加密）的加密字符串

##### HTTPS协议如何保证通信的安全？

通过加密和身份认证实现了当前技术环境下的安全通信。

##### HTTPS中证书的作用？

验证服务器身份

