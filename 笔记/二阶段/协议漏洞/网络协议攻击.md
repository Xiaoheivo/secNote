## 学习目标、重难点知识】

### 【学习目标】

1. <u>整理、背诵ARP攻击的原理</u>
2. <u>ARP攻击防御思路</u>
3. ARP攻击复现



![img](./%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%94%BB%E5%87%BB.assets/1650376157641-4f9b3029-34fb-4070-9928-42f90cac3cf3.png)

![img](./%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%94%BB%E5%87%BB.assets/1650376252959-fce07aa1-d931-47ff-87ab-037fa41b689a.png)

### Mac地址

查看mac地址：ipconfig /all

12位16进制数字， 占用48bits。

### ARP协议是什么？

将ip转成mac地址的协议

## ARP工作原理（理解）

### 工作机制

假设 A 和 B 位于同一链路，不需要经过路由器的转换，主机 A 向主机 B 发送一个 IP 分组，主机 A 的地址是 192.168.1.2 ，主机 B 的地址是 192.168.1.3，它们都不知道对方的 MAC 地址是啥，主机 C 和 主机 D 是同一链路的其他主机。

![img](./%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%94%BB%E5%87%BB.assets/1650377775996-e541dc1e-a962-41b6-a471-dfa9f138a95a.png)

主机 A 想要获取主机 B 的 MAC 地址，通过主机 A 会通过**广播** 的方式向以太网上的所有主机发送一个 **ARP 请求包**，这个 ARP 请求包中包含了主机 A 想要知道的主机 B 的 IP 地址。

![img](./%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%94%BB%E5%87%BB.assets/1650377936339-40bf20b0-c343-42b9-81f8-607925bc06e0.png)

主机 A 发送的 ARP 请求包会被同一链路上的所有主机/路由器接收并进行解析。每个主机/路由器都会检查 ARP 请求包中的信息，如果 ARP 请求包中的**目标 IP 地址 和自己的相同**，就会将自己主机的 MAC 地址写入响应包返回主机 A

![img](./%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%94%BB%E5%87%BB.assets/1650378032834-3f80fcdd-5eae-43ba-a0d4-cce7dbab95de.png)

由此，可以通过 ARP 从 IP 地址获取 MAC 地址，实现同一链路内的通信。

### ARP缓存（了解）

为了减少arp查询产生的过多网络包，网络主机在本机缓存的arp表。arp表有缓存期限。

查看arp缓存：arp -a

![img](./%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%94%BB%E5%87%BB.assets/1650414629675-405d1758-79d7-4e28-a6b1-d0a6fc4faa35.png)

删除arp缓存：arp -d(需要管理员权限)：

![img](./%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%94%BB%E5%87%BB.assets/1650414867648-c96f31ad-0368-4365-b548-22a901ddaeaa.png)



## <u>ARP攻击原理</u>

![img](./%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%94%BB%E5%87%BB.assets/1650425781545-47fcb696-d114-4599-a543-0581f2ee5d07.png)

网络中有A、B、C三台主机，主机A与主机B正常通信，主机C进入网络，开始实施ARP欺骗。

首先，主机C给主机A发一个ARP应答报文，报文显示主机B的IP地址映射主机C的MAC，主机A收到这个报文，更新自己的ARP缓存表，修改主机B的IP地址对应的MAC。这样，其后主机A发往主机B的数据包均会发给主机C。

如果主机C不转发该数据包到主机B，则主机B认为与主机A的通信发生故障，而主机A无法察觉。

如果主机C转发数据包到主机B，则主机B与主机A之间的通信不受影响，仅仅是主机C监听到主机A到主机B的数据包。同理，主机C发ARP应答报文欺骗主机B，则主机B发往主机A的数据包被主机C监听。

推荐：攻击机发送伪造的ARP广播，导致受害机获得通信目标主机的错误MAC地址，进而受害机流量被发到预期外主机上。



#### 翻译:B向A伪造C的身份,B向C伪造A的身份,当中间商赚差价



## <u>ARP攻击的危害</u>

冒充其他主机的MAC身份导致：

- **ARP 泛洪攻击**：通过向网关发送大量 ARP 报文，导致网关无法正常响应。

- **ARP 欺骗普通主机攻击**

- **欺骗网关的攻击**

- **中间人攻击**

## ARP防御

**1.主机级被动检测**

当系统接收到来自局域网上的ARP请求时，系统检查该请求发送端的IP地址是否与自己的IP地址相同。如果相同，则说明该网络上另有一台机器与自己具有相同的IP地址。

**2.主机级主动检测**

主机定期向所在局域网发送查询自己IP地址的ARP请求报文。如果能够收到另一ARP响应报文，则说明该网络上另有一台机器与自己具有相同的IP地址。

**3.服务器级检测**

当服务器收到ARP响应时，为了证实它的真实性，根据反向地址解析协议(RARP)就用从响应报文中给出的MAC地址再生成一个RARP请求，它询问这样一个问题：“如果你是这个MAC地址的拥有者，请回答你的IP地址”。这样就会查询到这个MAC地址对应的IP地址，比较这两个IP地址，如果不同，则说明对方伪造了ARP响应报文。

**4.网络级检测**

配置主机定期向中心管理主机报告其ARP缓存的内容。这样中心管理主机上的程序就会查找出两台主机报告信息的不一致，以及同一台主机前后报告内容的变化。这些情况反映了潜在的安全问题。或者利用网络嗅探工具连续监测网络内主机硬件地址与IP地址对应关系的变化。

\~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

上面的太官方，下面好懂一点：

- 在客户端使用arp命令绑定网关的真实MAC地址命令如下：

  arp -d *(先清除错误的ARP表,需要管理员权限)

  arp -s 192.168.xxx.xxx  xx-xx-xx-xx-xx-xx(静态指定网关的MAC地址)

- 在交换机上做端口与MAC地址的静态帮定。
- 在路由器上做IP地址与MAC地址的静态绑定。
- 使用”ARPSERVER”按一定时间间隔广播网段内所有主机的正确IP-MAC映射表。
- 最主要是要提高用户的安全意识，养成良好的安全习惯，包括：及时安装系统补丁程序，为系统设置强壮的密码，安装防火墙，安装有效的杀毒软件并及时升级病毒库
- 不主动进行网络攻击，不随便运行不受信任的软件。